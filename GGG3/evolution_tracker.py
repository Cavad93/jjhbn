# -*- coding: utf-8 -*-
"""
evolution_tracker.py ‚Äî –≠–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è

–ö–∞–∂–¥—ã–π —ç–∫—Å–ø–µ—Ä—Ç –∏ META –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–º, —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É—é—â–∏–π –æ—Ç –ø—Ä–æ—Å—Ç–µ–π—à–∏—Ö
—Ñ–æ—Ä–º –∂–∏–∑–Ω–∏ –¥–æ —á–µ–ª–æ–≤–µ–∫–∞ –ø–æ –º–µ—Ä–µ —É–ª—É—á—à–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫.
"""
from __future__ import annotations
import json
import os
from typing import Dict, Optional, Tuple
from dataclasses import dataclass

@dataclass
class EvolutionStage:
    """–û–¥–Ω–∞ —Å—Ç–∞–¥–∏—è —ç–≤–æ–ª—é—Ü–∏–∏"""
    level: int  # 0-100
    name: str
    emoji: str
    description: str
    min_accuracy: float
    max_accuracy: float

# 100-—É—Ä–æ–≤–Ω–µ–≤–∞—è —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–∞—è —à–∫–∞–ª–∞
EVOLUTION_STAGES = [
    # 0-10: –ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –∂–∏–∑–Ω–∏
    EvolutionStage(0, "–•–∏–º–∏—á–µ—Å–∫–∏–π —Å—É–ø", "üß™", "–•–∞–æ—Å, —Å–ª—É—á–∞–π–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è", 0.0, 0.35),
    EvolutionStage(1, "–†–ù–ö –º–æ–ª–µ–∫—É–ª–∞", "üß¨", "–ü–µ—Ä–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã", 0.35, 0.38),
    EvolutionStage(2, "–ü—Ä–æ–∫–∞—Ä–∏–æ—Ç", "ü¶†", "–ü—Ä–æ—Å—Ç–µ–π—à–∞—è –∫–ª–µ—Ç–∫–∞", 0.38, 0.40),
    EvolutionStage(3, "–ë–∞–∫—Ç–µ—Ä–∏—è", "ü¶†", "–ë–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞—á–∞—Ç–æ", 0.40, 0.42),
    EvolutionStage(4, "–¶–∏–∞–Ω–æ–±–∞–∫—Ç–µ—Ä–∏—è", "üü¢", "–§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑ –∑–Ω–∞–Ω–∏–π", 0.42, 0.44),
    EvolutionStage(5, "–ê—Ä—Ö–µ—è", "üî¥", "–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è", 0.44, 0.45),
    EvolutionStage(6, "–≠—É–∫–∞—Ä–∏–æ—Ç", "üîµ", "–Ø–¥—Ä–æ –ø–æ—è–≤–∏–ª–æ—Å—å", 0.45, 0.46),
    EvolutionStage(7, "–ê–º–µ–±–∞", "ü´ß", "–î–≤–∏–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–∏", 0.46, 0.47),
    EvolutionStage(8, "–ò–Ω—Ñ—É–∑–æ—Ä–∏—è", "ü¶†", "–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞", 0.47, 0.48),
    EvolutionStage(9, "–í–æ–¥–æ—Ä–æ—Å–ª—å", "üåø", "–ö–æ–ª–æ–Ω–∏–∞–ª—å–Ω–∞—è –∂–∏–∑–Ω—å", 0.48, 0.49),
    EvolutionStage(10, "–ü–ª–∞–Ω–∞—Ä–∏—è", "ü™±", "–ü–µ—Ä–≤–∞—è –Ω–µ—Ä–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞!", 0.49, 0.50),
    
    # 11-20: –ú–Ω–æ–≥–æ–∫–ª–µ—Ç–æ—á–Ω–∞—è –∂–∏–∑–Ω—å
    EvolutionStage(11, "–ì—É–±–∫–∞", "üßΩ", "–ú–Ω–æ–≥–æ–∫–ª–µ—Ç–æ—á–Ω—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º", 0.50, 0.51),
    EvolutionStage(12, "–ö–æ—Ä–∞–ª–ª", "ü™∏", "–°–∏–º–±–∏–æ–∑ –º–æ–¥–µ–ª–µ–π", 0.51, 0.52),
    EvolutionStage(13, "–ú–µ–¥—É–∑–∞", "ü™º", "–ü–ª–∞–≤–∞—é—â–∞—è –≤ –¥–∞–Ω–Ω—ã—Ö", 0.52, 0.53),
    EvolutionStage(14, "–ü–ª–æ—Å–∫–∏–π —á–µ—Ä–≤—å", "ü™±", "–î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–∏–º–º–µ—Ç—Ä–∏—è", 0.53, 0.54),
    EvolutionStage(15, "–ö—Ä—É–≥–ª—ã–π —á–µ—Ä–≤—å", "üêõ", "–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è", 0.54, 0.55),
    EvolutionStage(16, "–ö–æ–ª—å—á–∞—Ç—ã–π —á–µ—Ä–≤—å", "ü™±", "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤", 0.55, 0.56),
    EvolutionStage(17, "–ú–æ–ª–ª—é—Å–∫", "üêö", "–ó–∞—â–∏—Ç–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞", 0.56, 0.57),
    EvolutionStage(18, "–û—Å—å–º–∏–Ω–æ–≥", "üêô", "–í—ã—Å–æ–∫–∏–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç!", 0.57, 0.58),
    EvolutionStage(19, "–ú–æ—Ä—Å–∫–∞—è –∑–≤–µ–∑–¥–∞", "‚≠ê", "–†–∞–¥–∏–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞", 0.58, 0.59),
    EvolutionStage(20, "–ú–æ—Ä—Å–∫–æ–π –µ–∂", "ü¶î", "–ò–≥–ª–æ–∫–æ–∂–∏–π –∑–∞—â–∏—Ç–Ω–∏–∫", 0.59, 0.60),
    
    # 21-30: –•–æ—Ä–¥–æ–≤—ã–µ - –†—ã–±—ã
    EvolutionStage(21, "–õ–∞–Ω—Ü–µ—Ç–Ω–∏–∫", "üêü", "–•–æ—Ä–¥–∞ –ø–æ—è–≤–∏–ª–∞—Å—å", 0.60, 0.61),
    EvolutionStage(22, "–ú–∏–Ω–æ–≥–∞", "üêç", "–ü–µ—Ä–≤—ã–π –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫", 0.61, 0.62),
    EvolutionStage(23, "–ê–∫—É–ª–∞", "ü¶à", "–•–∏—â–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ", 0.62, 0.63),
    EvolutionStage(24, "–°–∫–∞—Ç", "‚óá", "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–æ–µ —á—É—Ç—å—ë", 0.63, 0.64),
    EvolutionStage(25, "–ö–æ—Å—Ç–Ω–∞—è —Ä—ã–±–∞", "üê†", "–ü—Ä–æ—á–Ω—ã–π —Å–∫–µ–ª–µ—Ç", 0.64, 0.65),
    EvolutionStage(26, "–õ–æ—Å–æ—Å—å", "üêü", "–ú–∏–≥—Ä–∞—Ü–∏—è –∫ —Ü–µ–ª–∏", 0.65, 0.66),
    EvolutionStage(27, "–£–≥–æ—Ä—å", "üêç", "–ì–∏–±–∫–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è", 0.66, 0.67),
    EvolutionStage(28, "–î–≤–æ—è–∫–æ–¥—ã—à–∞—â–∞—è", "ü´Å", "–î—ã—Ö–∞–Ω–∏–µ –Ω–∞ —Å—É—à–µ", 0.67, 0.68),
    EvolutionStage(29, "–ö–∏—Å—Ç–µ–ø—ë—Ä–∞—è —Ä—ã–±–∞", "ü¶¥", "–í—ã—Ö–æ–¥ –Ω–∞ —Å—É—à—É!", 0.68, 0.69),
    EvolutionStage(30, "–¢–∏–∫—Ç–∞–∞–ª–∏–∫", "üêä", "–ü–µ—Ä–µ—Ö–æ–¥–Ω–∞—è —Ñ–æ—Ä–º–∞", 0.69, 0.70),
    
    # 31-40: –ó–µ–º–Ω–æ–≤–æ–¥–Ω—ã–µ
    EvolutionStage(31, "–ò—Ö—Ç–∏–æ—Å—Ç–µ–≥–∞", "ü¶é", "–ü–µ—Ä–≤—ã–π —Ç–µ—Ç—Ä–∞–ø–æ–¥", 0.70, 0.71),
    EvolutionStage(32, "–ì–æ–ª–æ–≤–∞—Å—Ç–∏–∫", "üê∏", "–ú–µ—Ç–∞–º–æ—Ä—Ñ–æ–∑–∞ –Ω–∞—á–∞—Ç–∞", 0.71, 0.72),
    EvolutionStage(33, "–õ—è–≥—É—à–∫–∞", "üê∏", "–ê–º—Ñ–∏–±–∏—è –æ—Å–≤–æ–µ–Ω–∞", 0.72, 0.73),
    EvolutionStage(34, "–ñ–∞–±–∞", "üê∏", "–ù–∞–∑–µ–º–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è", 0.73, 0.74),
    EvolutionStage(35, "–°–∞–ª–∞–º–∞–Ω–¥—Ä–∞", "ü¶é", "–†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—à–∏–±–æ–∫", 0.74, 0.75),
    EvolutionStage(36, "–¢—Ä–∏—Ç–æ–Ω", "ü¶é", "–î–≤–æ–π–Ω–∞—è –∂–∏–∑–Ω—å", 0.75, 0.76),
    EvolutionStage(37, "–ß–µ—Ä–≤—è–≥–∞", "ü™±", "–†–æ—é—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º", 0.76, 0.77),
    EvolutionStage(38, "–õ–∞–±–∏—Ä–∏–Ω—Ç–æ–¥–æ–Ω—Ç", "üêä", "–ó—É–±—ã –ª–∞–±–∏—Ä–∏–Ω—Ç–∞", 0.77, 0.78),
    EvolutionStage(39, "–°–µ–π–º—É—Ä–∏—è", "ü¶é", "–ü–æ—á—Ç–∏ —Ä–µ–ø—Ç–∏–ª–∏—è", 0.78, 0.79),
    EvolutionStage(40, "–î–∏–∞–¥–µ–∫—Ç", "ü¶é", "–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–µ–ø—Ç–∏–ª–∏—è–º", 0.79, 0.80),
    
    # 41-50: –†–µ–ø—Ç–∏–ª–∏–∏
    EvolutionStage(41, "–ì–∏–ª–æ–Ω–æ–º—É—Å", "ü¶é", "–ü–µ—Ä–≤–∞—è —Ä–µ–ø—Ç–∏–ª–∏—è!", 0.80, 0.81),
    EvolutionStage(42, "–Ø—â–µ—Ä–∏—Ü–∞", "ü¶é", "–ß–µ—à—É–π—á–∞—Ç—ã–π –æ—Ö–æ—Ç–Ω–∏–∫", 0.81, 0.82),
    EvolutionStage(43, "–ó–º–µ—è", "üêç", "–ë–µ–∑–Ω–æ–≥–∏–π —Ö–∏—â–Ω–∏–∫", 0.82, 0.83),
    EvolutionStage(44, "–ß–µ—Ä–µ–ø–∞—Ö–∞", "üê¢", "–ü–∞–Ω—Ü–∏—Ä–Ω–∞—è –∑–∞—â–∏—Ç–∞", 0.83, 0.84),
    EvolutionStage(45, "–ö—Ä–æ–∫–æ–¥–∏–ª", "üêä", "–î—Ä–µ–≤–Ω–∏–π —Ö–∏—â–Ω–∏–∫", 0.84, 0.85),
    EvolutionStage(46, "–ü—Ç–µ—Ä–æ–∑–∞–≤—Ä", "ü¶á", "–ü–æ–ª—ë—Ç –æ—Å–≤–æ–µ–Ω", 0.85, 0.86),
    EvolutionStage(47, "–í–µ–ª–æ—Ü–∏—Ä–∞–ø—Ç–æ—Ä", "ü¶ñ", "–£–º–Ω—ã–π —Ö–∏—â–Ω–∏–∫", 0.86, 0.87),
    EvolutionStage(48, "–¢—Ä–∏—Ü–µ—Ä–∞—Ç–æ–ø—Å", "ü¶è", "–¢—Ä–∞–≤–æ—è–¥–Ω—ã–π —Ç–∞–Ω–∫", 0.87, 0.88),
    EvolutionStage(49, "–¢–∏—Ä–∞–Ω–Ω–æ–∑–∞–≤—Ä", "ü¶ñ", "–ö–æ—Ä–æ–ª—å –¥–∏–Ω–æ–∑–∞–≤—Ä–æ–≤!", 0.88, 0.89),
    EvolutionStage(50, "–ê—Ä—Ö–µ–æ–ø—Ç–µ—Ä–∏–∫—Å", "ü¶Ö", "–ü–µ—Ä–æ –ø–æ—è–≤–∏–ª–æ—Å—å", 0.89, 0.90),
    
    # 51-60: –ü—Ç–∏—Ü—ã
    EvolutionStage(51, "–í–æ—Ä–æ–±–µ–π", "üê¶", "–ú–µ–ª–∫–∞—è –ø—Ç–∏—Ü–∞", 0.90, 0.905),
    EvolutionStage(52, "–í–æ—Ä–æ–Ω–∞", "üê¶‚Äç‚¨õ", "–í—ã—Å–æ–∫–∏–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", 0.905, 0.91),
    EvolutionStage(53, "–ü–æ–ø—É–≥–∞–π", "ü¶ú", "–ò–º–∏—Ç–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤", 0.91, 0.915),
    EvolutionStage(54, "–°–æ–≤–∞", "ü¶â", "–ù–æ—á–Ω–æ–π –æ—Ö–æ—Ç–Ω–∏–∫", 0.915, 0.92),
    EvolutionStage(55, "–û—Ä—ë–ª", "ü¶Ö", "–û—Å—Ç—Ä–æ–µ –∑—Ä–µ–Ω–∏–µ", 0.92, 0.925),
    EvolutionStage(56, "–ü–∏–Ω–≥–≤–∏–Ω", "üêß", "–ù—ã—Ä–æ–∫ –≤ –≥–ª—É–±–∏–Ω—É", 0.925, 0.93),
    EvolutionStage(57, "–°—Ç—Ä–∞—É—Å", "ü¶§", "–ù–µ–ª–µ—Ç–∞—é—â–∏–π –≥–∏–≥–∞–Ω—Ç", 0.93, 0.935),
    EvolutionStage(58, "–ö–æ–ª–∏–±—Ä–∏", "üê¶", "–ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ", 0.935, 0.94),
    EvolutionStage(59, "–ê–ª—å–±–∞—Ç—Ä–æ—Å", "üïäÔ∏è", "–î–∞–ª—å–Ω–∏–π –ø–æ–ª—ë—Ç", 0.94, 0.945),
    EvolutionStage(60, "–°–æ–∫–æ–ª", "ü¶Ö", "–ü–∏–∫–∏—Ä—É—é—â–∏–π —É–¥–∞—Ä", 0.945, 0.95),
    
    # 61-70: –†–∞–Ω–Ω–∏–µ –º–ª–µ–∫–æ–ø–∏—Ç–∞—é—â–∏–µ
    EvolutionStage(61, "–ú–æ—Ä–≥–∞–Ω—É–∫–æ–¥–æ–Ω", "üê≠", "–ü–µ—Ä–≤–æ–µ –º–ª–µ–∫–æ–ø–∏—Ç–∞—é—â–µ–µ", 0.95, 0.952),
    EvolutionStage(62, "–û–ø–æ—Å—Å—É–º", "ü¶®", "–°—É–º—á–∞—Ç–æ–µ", 0.952, 0.954),
    EvolutionStage(63, "–Å–∂", "ü¶î", "–ö–æ–ª—é—á–∞—è –∑–∞—â–∏—Ç–∞", 0.954, 0.956),
    EvolutionStage(64, "–ú—ã—à—å", "üê≠", "–ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ", 0.956, 0.958),
    EvolutionStage(65, "–ë–µ–ª–∫–∞", "üêøÔ∏è", "–ó–∞–ø–∞—Å–ª–∏–≤–æ—Å—Ç—å", 0.958, 0.96),
    EvolutionStage(66, "–ö—Ä–æ–ª–∏–∫", "üê∞", "–ü–ª–æ–¥–æ–≤–∏—Ç–æ—Å—Ç—å", 0.96, 0.962),
    EvolutionStage(67, "–õ–∏—Å–∞", "ü¶ä", "–•–∏—Ç—Ä—ã–π –æ—Ö–æ—Ç–Ω–∏–∫", 0.962, 0.964),
    EvolutionStage(68, "–í–æ–ª–∫", "üê∫", "–°—Ç–∞–π–Ω–∞—è —Ç–∞–∫—Ç–∏–∫–∞", 0.964, 0.966),
    EvolutionStage(69, "–ú–µ–¥–≤–µ–¥—å", "üêª", "–ú–æ—â—å –∏ —Å–∏–ª–∞", 0.966, 0.968),
    EvolutionStage(70, "–õ–µ–≤", "ü¶Å", "–¶–∞—Ä—å –∑–≤–µ—Ä–µ–π", 0.968, 0.97),
    
    # 71-80: –ü—Ä–∏–º–∞—Ç—ã
    EvolutionStage(71, "–õ–µ–º—É—Ä", "üêí", "–ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π –ø—Ä–∏–º–∞—Ç", 0.97, 0.972),
    EvolutionStage(72, "–î–æ–ª–≥–æ–ø—è—Ç", "üëÄ", "–ë–æ–ª—å—à–∏–µ –≥–ª–∞–∑–∞", 0.972, 0.974),
    EvolutionStage(73, "–ö–∞–ø—É—Ü–∏–Ω", "üêµ", "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã!", 0.974, 0.976),
    EvolutionStage(74, "–ú–∞–∫–∞–∫–∞", "üêí", "–°–æ—Ü–∏–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", 0.976, 0.978),
    EvolutionStage(75, "–ü–∞–≤–∏–∞–Ω", "ü¶ß", "–°–ª–æ–∂–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è", 0.978, 0.98),
    EvolutionStage(76, "–ì–∏–±–±–æ–Ω", "ü¶ß", "–ë—Ä–∞—Ö–∏–∞—Ü–∏—è –æ—Å–≤–æ–µ–Ω–∞", 0.98, 0.982),
    EvolutionStage(77, "–û—Ä–∞–Ω–≥—É—Ç–∞–Ω", "ü¶ß", "–û–¥–∏–Ω–æ—á–Ω—ã–π –º—ã—Å–ª–∏—Ç–µ–ª—å", 0.982, 0.984),
    EvolutionStage(78, "–ì–æ—Ä–∏–ª–ª–∞", "ü¶ç", "–°–∏–ª–∞ –∏ —Ä–∞–∑—É–º", 0.984, 0.986),
    EvolutionStage(79, "–®–∏–º–ø–∞–Ω–∑–µ", "üêµ", "99% –î–ù–ö —á–µ–ª–æ–≤–µ–∫–∞", 0.986, 0.988),
    EvolutionStage(80, "–ë–æ–Ω–æ–±–æ", "ü¶ß", "–≠–º–ø–∞—Ç–∏—è —Ä–∞–∑–≤–∏—Ç–∞", 0.988, 0.99),
    
    # 81-90: –ì–æ–º–∏–Ω–∏–¥—ã
    EvolutionStage(81, "–°–∞—Ö–µ–ª–∞–Ω—Ç—Ä–æ–ø", "ü¶¥", "–î—Ä–µ–≤–Ω–µ–π—à–∏–π –≥–æ–º–∏–Ω–∏–¥", 0.99, 0.991),
    EvolutionStage(82, "–ê—Ä–¥–∏–ø–∏—Ç–µ–∫", "ü¶¥", "–ü—Ä—è–º–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å", 0.991, 0.992),
    EvolutionStage(83, "–ê–≤—Å—Ç—Ä–∞–ª–æ–ø–∏—Ç–µ–∫", "ü¶ç", "–õ—é—Å–∏ –∂–∏–≤—ë—Ç", 0.992, 0.993),
    EvolutionStage(84, "–ß–µ–ª–æ–≤–µ–∫ —É–º–µ–ª—ã–π", "ü™®", "–ü–µ—Ä–≤—ã–µ –æ—Ä—É–¥–∏—è!", 0.993, 0.994),
    EvolutionStage(85, "–ß–µ–ª–æ–≤–µ–∫ –ø—Ä—è–º–æ—Ö–æ–¥—è—â–∏–π", "üî•", "–û–≥–æ–Ω—å –æ—Å–≤–æ–µ–Ω", 0.994, 0.995),
    EvolutionStage(86, "–ì–µ–π–¥–µ–ª—å–±–µ—Ä–≥—Å–∫–∏–π —á–µ–ª–æ–≤–µ–∫", "üèπ", "–û—Ö–æ—Ç–Ω–∏–∫ —Å –∫–æ–ø—å—ë–º", 0.995, 0.996),
    EvolutionStage(87, "–ù–µ–∞–Ω–¥–µ—Ä—Ç–∞–ª–µ—Ü", "üßä", "–õ–µ–¥–Ω–∏–∫–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥", 0.996, 0.997),
    EvolutionStage(88, "–î–µ–Ω–∏—Å–æ–≤—Å–∫–∏–π —á–µ–ª–æ–≤–µ–∫", "üèîÔ∏è", "–ì–æ—Ä–Ω—ã–π –∂–∏—Ç–µ–ª—å", 0.997, 0.998),
    EvolutionStage(89, "–ö—Ä–æ–º–∞–Ω—å–æ–Ω–µ—Ü", "üé®", "–ù–∞—Å–∫–∞–ª—å–Ω–∞—è –∂–∏–≤–æ–ø–∏—Å—å", 0.998, 0.999),
    EvolutionStage(90, "–ß–µ–ª–æ–≤–µ–∫ —Ä–∞–∑—É–º–Ω—ã–π", "üë§", "Homo sapiens!", 0.999, 1.0),
    
    # 91-100: –¶–∏–≤–∏–ª–∏–∑–∞—Ü–∏—è
    EvolutionStage(91, "–û—Ö–æ—Ç–Ω–∏–∫-—Å–æ–±–∏—Ä–∞—Ç–µ–ª—å", "üèπ", "–ö–æ—á–µ–≤–∞—è –∂–∏–∑–Ω—å", 1.0, 1.0),
    EvolutionStage(92, "–ó–µ–º–ª–µ–¥–µ–ª–µ—Ü", "üåæ", "–ê–≥—Ä–∞—Ä–Ω–∞—è —Ä–µ–≤–æ–ª—é—Ü–∏—è", 1.0, 1.0),
    EvolutionStage(93, "–†–µ–º–µ—Å–ª–µ–Ω–Ω–∏–∫", "üî®", "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä—É–¥–∞", 1.0, 1.0),
    EvolutionStage(94, "–ö—É–ø–µ—Ü", "üí∞", "–¢–æ—Ä–≥–æ–≤–ª—è –∑–Ω–∞–Ω–∏—è–º–∏", 1.0, 1.0),
    EvolutionStage(95, "–£—á—ë–Ω—ã–π", "üî¨", "–ù–∞—É—á–Ω—ã–π –º–µ—Ç–æ–¥", 1.0, 1.0),
    EvolutionStage(96, "–ò–Ω–∂–µ–Ω–µ—Ä", "‚öôÔ∏è", "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å", 1.0, 1.0),
    EvolutionStage(97, "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç", "üíª", "–¶–∏—Ñ—Ä–æ–≤–∞—è —ç—Ä–∞", 1.0, 1.0),
    EvolutionStage(98, "AI –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å", "ü§ñ", "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", 1.0, 1.0),
    EvolutionStage(99, "–ú–∞—Å—Ç–µ—Ä ML", "üß†", "–°–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ!", 1.0, 1.0),
    EvolutionStage(100, "–°–∏–Ω–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å", "‚ú®", "–ü—Ä–µ–≤–∑–æ—à—ë–ª —Å–æ–∑–¥–∞—Ç–µ–ª—è", 1.0, 1.0),
]

class EvolutionTracker:
    """–¢—Ä–µ–∫–µ—Ä —ç–≤–æ–ª—é—Ü–∏–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤"""
    
    def __init__(self, output_dir: str = "training_viz"):
        self.output_dir = output_dir
        self.evolution_file = os.path.join(output_dir, "evolution_state.json")
        
        # –¢–µ–∫—É—â–∏–µ —É—Ä–æ–≤–Ω–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
        self.levels: Dict[str, int] = {
            "XGB": 0,
            "RF": 0,
            "ARF": 0,
            "NN": 0,
            "META": 0
        }
        
        # –ò—Å—Ç–æ—Ä–∏—è —É—Ä–æ–≤–Ω–µ–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å)
        self.last_notified: Dict[str, int] = {
            "XGB": -1,
            "RF": -1,
            "ARF": -1,
            "NN": -1,
            "META": -1
        }
        
        self._load_state()
    
    def accuracy_to_level(self, accuracy: float) -> int:
        """–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç accuracy –≤ —É—Ä–æ–≤–µ–Ω—å —ç–≤–æ–ª—é—Ü–∏–∏ (0-100)"""
        # –ù–∞—Ö–æ–¥–∏–º –ø–æ–¥—Ö–æ–¥—è—â—É—é —Å—Ç–∞–¥–∏—é
        for stage in EVOLUTION_STAGES:
            if stage.min_accuracy <= accuracy < stage.max_accuracy:
                return stage.level
        
        # –î–ª—è accuracy >= 1.0 –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
        if accuracy >= 1.0:
            return 100
        
        # –î–ª—è –æ—á–µ–Ω—å –Ω–∏–∑–∫–∏—Ö accuracy
        return 0
    
    def get_stage(self, level: int) -> EvolutionStage:
        """–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞–¥–∏–∏ –ø–æ —É—Ä–æ–≤–Ω—é"""
        for stage in EVOLUTION_STAGES:
            if stage.level == level:
                return stage
        return EVOLUTION_STAGES[0]  # Fallback
    
    def update_expert(self, expert_name: str, accuracy: float) -> Optional[EvolutionStage]:
        """
        –û–±–Ω–æ–≤–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å —ç–∫—Å–ø–µ—Ä—Ç–∞
        
        Returns:
            EvolutionStage –µ—Å–ª–∏ –±—ã–ª –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å, –∏–Ω–∞—á–µ None
        """
        new_level = self.accuracy_to_level(accuracy)
        old_level = self.levels.get(expert_name, 0)
        
        self.levels[expert_name] = new_level
        self._save_state()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –ø–æ—Ä–æ–≥ 10 —É—Ä–æ–≤–Ω–µ–π)
        if new_level >= old_level + 10:
            return self.get_stage(new_level)
        
        return None
    
    def should_notify(self, expert_name: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"""
        current_level = self.levels.get(expert_name, 0)
        last_level = self.last_notified.get(expert_name, -1)
        
        # –£–≤–µ–¥–æ–º–ª—è–µ–º –∫–∞–∂–¥—ã–µ 10 —É—Ä–æ–≤–Ω–µ–π
        if current_level >= last_level + 10:
            self.last_notified[expert_name] = current_level
            return True
        
        return False
    
    def _save_state(self):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ"""
        try:
            data = {
                "levels": self.levels,
                "last_notified": self.last_notified
            }
            with open(self.evolution_file, "w", encoding="utf-8") as f:
                json.dump(data, f, ensure_ascii=False, indent=2)
        except Exception:
            from error_logger import log_exception
            log_exception("Failed to save JSON")
    
    def _load_state(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ"""
        try:
            if os.path.exists(self.evolution_file):
                with open(self.evolution_file, "r", encoding="utf-8") as f:
                    data = json.load(f)
                self.levels = data.get("levels", self.levels)
                self.last_notified = data.get("last_notified", self.last_notified)
        except Exception:
            from error_logger import log_exception
            log_exception("Failed to load JSON")

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
_evolution_tracker: Optional[EvolutionTracker] = None

def get_evolution_tracker(output_dir: str = "training_viz") -> EvolutionTracker:
    """–ü–æ–ª—É—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ç—Ä–µ–∫–µ—Ä —ç–≤–æ–ª—é—Ü–∏–∏"""
    global _evolution_tracker
    if _evolution_tracker is None:
        _evolution_tracker = EvolutionTracker(output_dir)
    return _evolution_tracker